<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="/blog/css/materialize.min.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="/blog/css/jqcloud.min.css" />
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
  <link type="text/css" rel="stylesheet" href="css/jqcloud.min.css" />

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/blog/js/materialize.min.js"></script>
  <script type="text/javascript" src="/blog/js/jqcloud.min.js"></script>
  <script type="text/javascript" src="js/materialize.min.js"></script>
  <script type="text/javascript" src="js/jqcloud.min.js"></script>
  <style>
    body {
      background-color: #fafafa;
    }

    nav {
      background-color: #673AB7;
    }

    h2,
    h3,
    h4 {
      color: #673AB7;
    }

    .card.waves-effect,
    .card .waves-effect {
      display: block;
    }
  </style>
  <script>
    // TODO: Fix the whole /blog in css  +js + redirects
    // TODO: Implement 404 page in this page
    $(function () {
      var posts =
        [
          {
            title: 'Bulding a real SPA blog',
            date: '2017-07-27 22:00',
            summary: 'This blog is a real SPA with no backend code.',
            niceUrl: '/2017/07/building-a-real-spa-blog',
            category:
            {
              title: 'Software development',
              url: '/software-development'
            },
            tags: [
              {
                title: 'JavaScript',
                url: '/javascript'
              }
            ]
          },
          {
            title: 'Chromecast on the go',
            niceUrl: '/chromecast-on-the-go',
            category:
            {
              title: 'Tech',
              url: '/tech'
            },
            tags: [
              {
                title: 'Chromecast',
                url: '/chromecast'
              }
            ]
          },
          {
            title: 'The pain of releasing an app in 2017',
            niceUrl: '/the-pain-of-releasing-an-app-in-2017',
            category:
            {
              title: 'Software development',
              url: '/software-development'
            },
            tags: [
              {
                title: 'App',
                url: '/app'
              },
              {
                title: 'eSports',
                url: '/esports'
              }
            ]
          },
          {
            title: 'Information leak using customer\'s e-mail address',
            niceUrl: '/the-pain-of-releasing-an-app-in-2017',
            category:
            {
              title: 'Security',
              url: '/security'
            },
            tags: [
              {
                title: 'App',
                url: '/app'
              },
              {
                title: 'Chromecast',
                url: '/chromecast'
              }
            ]
          }
        ];
      var categories = [];
      var tags = [];
      posts.forEach(function (post) {
        if (post.category) {
          categories.forEach(function (category, index) {
            if (post.category.title === category.title) {
              categories.splice(index, 1);
            }
          });
          categories.push(post.category);
        }
        if (post.tags) {
          post.tags.forEach(function (postTag, index) {
            var foundTag = false;
            tags.forEach(function (existingTag, index) {
              if (!foundTag && postTag.title === existingTag.text) {
                existingTag.weight = existingTag.weight + 1;
                foundTag = true;
              }
            });
            if (!foundTag) {
              tags.push({ text: postTag.title, link: postTag.url, weight: 1 });
            }
          });
        }
      }, this);
      categories.sort(function (a, b) {
        if (a.title < b.title)
          return -1;
        if (a.title > b.title)
          return 1;
        return 0;
      });

      var contentViewModel = {
        posts: posts,
        categories: categories
      };
      ko.applyBindings(contentViewModel);

      $('#tag-cloud').jQCloud(tags, {
        autoResize: true,
        delay: 300
      });
    });
    function goToFrontpage() {
      goToUrl(null, 'My blog', '/');
    }
    function goToPost(post) {
      goToUrl(null, post.title, post.niceUrl);
    }
    function goToCategory(category) {
      goToUrl(null, category.title, '/category' + category.url);
    }
    function goToUrl(state, title, url) {
      url = '/blog' + url;
      console.log('goToUrl()', url);
      try {
        history.pushState(state, title, url)
        // If push state throws an exception the page view will automatically be logged on next page load
        ga('set', {
          page: url,
          title: title
        });
        ga('send', 'pageview');
      } catch (e) {
        console.error(e);
        if (location.protocol !== 'file:') {
          location.href = url;
        } else {
          location.href = '#' + url;
        }
      }
    }
  </script>
</head>

<body>
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-392774-1', 'auto');
    ga('send', 'pageview');
  </script>
  <nav>
    <div class="nav-wrapper">
      <div class="container">
        <a href="/blog/" class="brand-logo left" data-bind="click: function(){goToFrontpage()}">My blog</a>
        <ul id="nav-mobile" class="right">
          <li><a href="http://roysolberg.com">roysolberg.com</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <h4>Latest posts</h4>
    <div class="row" data-bind="foreach: {data: posts, as: 'post'}">
      <div class="col s12 m4">
        <div class="card">
          <div class="card-content waves-effect" data-bind="click: function(){goToPost(post)}">
            <span class="card-title" data-bind="text: post.title"></span>
            <p data-bind="text: post.summary"></p>
          </div>
          <div class="card-action">
            <a href="#" data-bind="attr: { href: post.niceUrl}, click: function(){goToPost(post)}">Read more</a>
          </div>
        </div>
        <a href="#" data-bind="attr: { href: post.niceUrl}"></a>
      </div>
    </div>
    <h4>Categories</h4>
    <div class="row" data-bind="foreach: {data: categories, as: 'category'}">
      <div class="col s12 m4">
        <div class="card">
          <div class="card-content waves-effect" data-bind="click: function(){goToCategory(category)}">
            <span class="card-title" data-bind="text: category.title"></span>
          </div>
        </div>
        <a href="#" data-bind="attr: { href: category.url}"></a>
      </div>
    </div>
    <h4>Tags</h4>
    <div class="row">
    </div>
    <div id="tag-cloud" style="width:100%;height:200px;"></div>
    <div id="disqus_thread"></div>
  </div>
  <script>
    /**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
    var disqus_config = function () {
      this.page.url = 'http://blog.roysolberg.com';  // Replace PAGE_URL with your page's canonical URL variable
      //this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function () { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://roysolberg.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      //(d.head || d.body).appendChild(s);
    })();
  </script>
</body>

</html>